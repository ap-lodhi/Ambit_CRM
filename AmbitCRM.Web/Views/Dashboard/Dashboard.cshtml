@{
    ViewData["Title"] = "Dashboard";
}


<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">


</head>

<body>

    <main>
        <div class="container-fluid py-3">
            <div class="row">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header bg-white">
                            <div class="row">
                                <div class="col-md-2">
                                    <div class="d-flex align-items-center">
                                        <div class="flex-shrink-0">
                                            <button class="btn"
                                                    type="button"
                                                    data-bs-toggle="collapse"
                                                    data-bs-target="#collapseWidthExample"
                                                    aria-expanded="false"
                                                    aria-controls="collapseWidthExample">

                                                <img src="~/assets/images/hamburger.svg" alt="..." />
                                            </button>
                                        </div>
                                        <div class="flex-grow-1 ms-3">Home</div>
                                    </div>
                                </div>
                                <div class="col-md-10">
                                    <nav class="navbar navbar-expand-lg">
                                        <div class="container-fluid">
                                            <div class="navbar-collapse bg-white"
                                                 id="navbarSupportedContent">
                                                <div class="navbar-nav me-auto mb-2 mb-lg-0">
                                                    <select class="form-select"
                                                            aria-label="Default select example">
                                                        <option selected>Select Column</option>
                                                        <option value="1">One</option>
                                                        <option value="2">Two</option>
                                                        <option value="3">Three</option>
                                                    </select>
                                                </div>
                                                <form class="d-flex" role="search">
                                                    <select class="form-select"
                                                            aria-label="Default select example">
                                                        <option selected>Show</option>
                                                        <option value="1">Hide</option>
                                                    </select>
                                                </form>
                                            </div>
                                        </div>
                                    </nav>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-md-2 collapse collapse-horizontal show p-0"
                                    @* file-include-html="assets/includes/sidebar.html" *@
                                         id="collapseWidthExample">


                                        <div class="card border-start-0 border-top-0 border-bottom-0">
                                            <div class="card-body">
                                                <div class="row">
                                                    <div class="col-md-12 py-2">
                                                        <input class="form-control me-2"
                                                               type="search"
                                                               placeholder="Search Keyword"
                                                               aria-label="Search" />
                                                    </div>
                                                    <div class="col-md-12 py-2">
                                                        <div class="card">
                                                            <button class="btn btn-color w-100 d-flex justify-content-between align-items-center"
                                                                    type="button"
                                                                    data-bs-toggle="collapse"
                                                                    data-bs-target="#collapseExample"
                                                                    aria-expanded="false"
                                                                    aria-controls="collapseExample">
                                                                <span>
                                                                    <img src="~/assets/images/hamburger2.svg" alt="" /> Advanced
                                                                    Search
                                                                </span>
                                                                <img src="~/assets/images/Drop-down-icon.svg" alt="" class="arrow" />
                                                            </button>
                                                            <div class="collapse show" id="collapseExample">
                                                                <div class="card card-body border-0 shadow-none">

                                                                    <div class="mb-3">
                                                                        <input type="text"
                                                                               class="form-control"
                                                                               placeholder="Enter Company Name" id="company" />
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <input type="text"
                                                                               class="form-control"
                                                                               placeholder="Enter Contact Name" id="contact" />
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <input type="email"
                                                                               class="form-control"
                                                                               placeholder="Enter Email Address" id="email" />
                                                                    </div>
                                                                    <div class="mb-3">
                                                                        <input type="text"
                                                                               class="form-control"
                                                                               placeholder="Enter City" id="city" />
                                                                    </div>
                                                                    <button type="submit" class="btn btn-color w-100 mb-2" id="btnSearch">
                                                                        <img src="~/assets/images/search.svg" alt="" />
                                                                        Exact Search
                                                                    </button>
                                                                    <button type="submit" class="btn btn-color w-100 mb-2">
                                                                        <img src="~/assets/images/similar_search.svg" alt="" />
                                                                        Similar Search
                                                                    </button><button type="submit" class="btn btn-color w-100 mb-3">
                                                                        <img src="~/assets/images/related_search.svg" alt="" />
                                                                        Related Search
                                                                    </button>

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-10" id="main">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="table-responsive rounded-3 border">
                                                    <table class="table m-0" id="tblContact">
                                                        <thead>
                                                            <tr>
                                                                <th></th>
                                                                <th>Contact Id</th>                                                           
                                                                <th>Company Name</th>
                                                                <th>Contact Name</th>
                                                                <th>Email</th>
                                                                <th>City</th>
                                                                <th>Source</th>
                                                                <th>Contact Type</th>
                                                                <th>RM</th>
                                                                <th>Creation Date</th>
                                                                <th>Last Interaction Date</th>
                                                                <th>Last Interaction With</th>
                                                            </tr>
                                                        </thead>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</body>
</html>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css" />
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>


<script>
    jQuery.noConflict();
    jQuery(document).ready(function ($) {
        var companyInput = $('#company');
        debugger;
        var contactInput = $('#contact');
        var emailInput = $('#email');
        var cityInput = $('#city');
        debugger;
        var searchButton = $('#btnSearch');
        debugger;
        var table = $('#tblContact').DataTable({
            serverSide: true,
            ajax: {
                url: '/Dashboard/GetContact',
                type: 'POST',
                data: function (data) {
                    data.length = data.length;
                    data.start = data.start;
                    data.searchText = data.search.value;
                    data.sortColumn = data.columns[data.order[0].column].data;
                    data.sortDirection = data.order[0].dir;
                    data.CompanyName = companyInput.val();
                    data.ContactName = contactInput.val();
                    data.Email = emailInput.val();
                    data.City = cityInput.val();
                }
            },
            language: {
                emptyTable: "No record found.",
                processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw" style="color:#2a2b2b;"></i><span class="sr-only">Loading...</span>'
            },
            columnDefs: [
                { targets: [1], visible: false }, // Hides the first column (index 0)
                { targets: '_all', visible: true } // Shows all other columns
              //  { targets: [1, 3, 4, 5, 6, 7, 8, 9, 10] },
              //  { targets: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] }
            ],
            columns: [
                {
                    data: 'icon',
                    render: function (data, type, row)
                    {
                        return '<button class="btn btn-icon" data-contact-id="' + row.contactId + '"><i class="far fa-star text-muted"></i></button>';
                    }
                },
                { data: 'contactId', visible: false }, // Hides the contactId column
                { data: 'companyName' },
                { data: 'contactName' },
                { data: 'email' },
                { data: 'city' },
                { data: 'source' },
                { data: 'contactType' },
                { data: 'rm' },
                {
                    data: 'creationDate',
                    render: function (data, type, row) {
                        var date = data.split('T')[0];
                        return date;
                    }
                },
                {
                    data: 'lastInsertionDate',
                    render: function (data, type, row) {
                        var date = data.split('T')[0];
                        return date;
                    }
                },
                { data: 'lastInsertionWith' }
            ],
            paging: true,
            pageLength: 10,
            searching: true,
            dom: '<"top row"<"col-6"l><"col-6"f>>rt<"bottom"ip>',
            buttons: [{
                extend: 'colvis',
                text: 'Select Columns',
                className: 'btn btn-primary',
                columns: ':gt(0)'
            }]
        });

        // Event listener for clicking the star icon
        $(document).on('click', '.btn-icon', function () {
            var starIcon = $(this).find('i');
            var contactId = $(this).data('contact-id');

            if (starIcon.hasClass('fas')) {
                // If star is already filled, change color to grey and remove filled class

                starIcon.removeClass('fas text-warning').addClass('far text-muted');
                $.ajax({
                    url: '/Dashboard/BookMarked', 
                    method: 'POST',
                    data: { contactId: contactId,
                        IsBookMarked: false,
                        UserId:1
                    },
                    success: function (response) {
                      
                    },
                    error: function (xhr, status, error) {
                        // Handle error
                        console.error(error);

                    }
                });
            } else {
                // If star is empty, change color to red and add filled class
                starIcon.removeClass('far text-muted').addClass('fas text-danger');
                $.ajax({
                    url: '/Dashboard/BookMarked', 
                    method: 'POST',
                    data: {
                        contactId: contactId,
                        IsBookMarked: true,
                        UserId: 1
                    },
                    success: function (response) {

                    },
                    error: function (xhr, status, error) {
                        // Handle error
                        console.error(error);

                    }
                });
            }
        });


        searchButton.click(function () {
            table.draw();
        });
    });

</script> 